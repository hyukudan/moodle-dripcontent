define("availability_dripcontent/form",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t={initInner:function(e){this.modes=e.availability_dripcontent.modes,this.units=e.availability_dripcontent.units},getNode:function(e){var t=document.createElement("div");t.className="availability-dripcontent";var a=e.mode||"coursedays",n=e.unit||"days",i=e.value||1,r=e.fromdate||"",o=e.todate||"";return this.buildForm(t,a,n,i,r,o),this.setupEventListeners(t),this.updateVisibility(t,a),t},createFormRow:function(e,t){var a=document.createElement("div");a.className="form-group row mb-2",t&&(a.className+=" "+t);var n=document.createElement("label");n.className="col-sm-3 col-form-label",n.textContent=e;var i=document.createElement("div");return i.className="col-sm-9",a.appendChild(n),a.appendChild(i),{row:a,contentDiv:i}},createSelect:function(e,t){var a=document.createElement("select");return a.className="form-control "+e,t.forEach((function(e){var t=document.createElement("option");t.value=e.value,t.textContent=e.text,e.selected&&(t.selected=!0),a.appendChild(t)})),a},buildForm:function(e,t,a,n,i,r){var o=i?this.timestampToDateString(i):"",l=r?this.timestampToDateString(r):"",d=this.createFormRow(M.util.get_string("mode","availability_dripcontent"),""),c=this.createSelect("dripcontent-mode",[{value:"coursedays",text:M.util.get_string("mode_coursedays","availability_dripcontent"),selected:"coursedays"===t},{value:"subscriptiondays",text:M.util.get_string("mode_subscriptiondays","availability_dripcontent"),selected:"subscriptiondays"===t},{value:"daterange",text:M.util.get_string("mode_daterange","availability_dripcontent"),selected:"daterange"===t}]);d.contentDiv.appendChild(c),e.appendChild(d.row);var u=document.createElement("div");u.className="form-group row mb-2 dripcontent-timevalue";var s=document.createElement("label");s.className="col-sm-3 col-form-label",s.textContent=M.util.get_string("value","availability_dripcontent");var p=document.createElement("div");p.className="col-sm-4";var m=document.createElement("input");m.type="number",m.className="form-control dripcontent-value",m.min="0",m.value=n,p.appendChild(m);var v=document.createElement("div");v.className="col-sm-5";var y=this.createSelect("dripcontent-unit",[{value:"days",text:M.util.get_string("unit_days","availability_dripcontent"),selected:"days"===a},{value:"months",text:M.util.get_string("unit_months","availability_dripcontent"),selected:"months"===a}]);v.appendChild(y),u.appendChild(s),u.appendChild(p),u.appendChild(v),e.appendChild(u);var f=this.createFormRow(M.util.get_string("fromdate","availability_dripcontent"),"dripcontent-daterange");f.row.style.display="none";var h=document.createElement("input");h.type="date",h.className="form-control dripcontent-fromdate",h.value=o,f.contentDiv.appendChild(h),e.appendChild(f.row);var g=this.createFormRow(M.util.get_string("todate","availability_dripcontent"),"dripcontent-daterange");g.row.style.display="none";var _=document.createElement("input");_.type="date",_.className="form-control dripcontent-todate",_.value=l,g.contentDiv.appendChild(_),e.appendChild(g.row)},timestampToDateString:function(e){return new Date(1e3*e).toISOString().split("T")[0]},dateStringToTimestamp:function(e){if(!e)return null;var t=new Date(e+"T00:00:00");return Math.floor(t.getTime()/1e3)},setupEventListeners:function(e){var t=this,a=e.querySelector(".dripcontent-mode"),n=e.querySelector(".dripcontent-value"),i=e.querySelector(".dripcontent-unit"),r=e.querySelector(".dripcontent-fromdate"),o=e.querySelector(".dripcontent-todate");a.addEventListener("change",(function(){t.updateVisibility(e,a.value),M.core_availability.form.update()})),n.addEventListener("input",(function(){M.core_availability.form.update()})),i.addEventListener("change",(function(){M.core_availability.form.update()})),r.addEventListener("change",(function(){M.core_availability.form.update()})),o.addEventListener("change",(function(){M.core_availability.form.update()}))},updateVisibility:function(e,t){var a=e.querySelector(".dripcontent-timevalue"),n=e.querySelectorAll(".dripcontent-daterange");"daterange"===t?(a.style.display="none",n.forEach((function(e){e.style.display="flex"}))):(a.style.display="flex",n.forEach((function(e){e.style.display="none"})))},fillValue:function(e,t){var a=t.querySelector(".dripcontent-mode"),n=t.querySelector(".dripcontent-value"),i=t.querySelector(".dripcontent-unit"),r=t.querySelector(".dripcontent-fromdate"),o=t.querySelector(".dripcontent-todate");e.mode&&(a.value=e.mode),e.unit&&(i.value=e.unit),void 0!==e.value&&(n.value=e.value),e.fromdate&&(r.value=this.timestampToDateString(e.fromdate)),e.todate&&(o.value=this.timestampToDateString(e.todate)),this.updateVisibility(t,a.value)},fillErrors:function(e,t){var a=t.querySelector(".dripcontent-mode").value,n=t.querySelector(".dripcontent-value").value,i=t.querySelector(".dripcontent-fromdate").value,r=t.querySelector(".dripcontent-todate").value;"daterange"!==a?(""===n||isNaN(parseInt(n))||parseInt(n)<0)&&e.push("availability_dripcontent:error_invalidvalue"):(i||r||e.push("availability_dripcontent:error_invaliddate"),i&&r&&new Date(i)>=new Date(r)&&e.push("availability_dripcontent:error_dateorder"))},getValue:function(e){var t=e.querySelector(".dripcontent-mode").value,a={type:"dripcontent",mode:t};if("daterange"===t){var n=e.querySelector(".dripcontent-fromdate").value,i=e.querySelector(".dripcontent-todate").value;n&&(a.fromdate=this.dateStringToTimestamp(n)),i&&(a.todate=this.dateStringToTimestamp(i))}else a.unit=e.querySelector(".dripcontent-unit").value,a.value=parseInt(e.querySelector(".dripcontent-value").value)||0;return a}};e.default=t}));