define("availability_dripcontent/form",["exports"],(function(e){"use strict";function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={enrolmentMethods:{},initInner:function(e){this.modes=e.availability_dripcontent.modes,this.units=e.availability_dripcontent.units,this.enrolmentMethods=e.availability_dripcontent.enrolmentmethods||{}},getNode:function(e){var t=document.createElement("div");t.className="availability-dripcontent";var n=e.mode||"coursedays",r=e.unit||"days",a=e.value||1,i=e.fromdate||"",o=e.todate||"",l=e.enrolmentmethods||[];return this.buildForm(t,n,r,a,i,o,l),this.setupEventListeners(t),this.updateVisibility(t,n),t},createFormRow:function(e,t){var n=document.createElement("div");n.className="form-group row mb-2",t&&(n.className+=" "+t);var r=document.createElement("label");r.className="col-sm-4 col-form-label",r.textContent=e;var a=document.createElement("div");return a.className="col-sm-8",n.appendChild(r),n.appendChild(a),{row:n,contentDiv:a}},createSelect:function(e,t){var n=document.createElement("select");return n.className="form-control "+e,t.forEach((function(e){var t=document.createElement("option");t.value=e.value,t.textContent=e.text,e.selected&&(t.selected=!0),n.appendChild(t)})),n},createMultiSelect:function(e,n){var r=document.createElement("select");r.className="form-control "+e,r.multiple=!0,r.size=4;var a=document.createElement("option");return a.value="",a.textContent=M.util.get_string("allenrolmentmethods","availability_dripcontent"),n&&0!==n.length||(a.selected=!0),r.appendChild(a),Object.entries(this.enrolmentMethods).forEach((function(e){var a=t(e,2),i=a[0],o=a[1],l=document.createElement("option");l.value=i,l.textContent=o,n&&n.includes(i)&&(l.selected=!0),r.appendChild(l)})),r},buildForm:function(e,t,n,r,a,i,o){var l=a?this.timestampToDateString(a):"",d=i?this.timestampToDateString(i):"",c=this.createFormRow(M.util.get_string("mode","availability_dripcontent"),""),u=this.createSelect("dripcontent-mode",[{value:"coursedays",text:M.util.get_string("mode_coursedays","availability_dripcontent"),selected:"coursedays"===t},{value:"coursestartdays",text:M.util.get_string("mode_coursestartdays","availability_dripcontent"),selected:"coursestartdays"===t},{value:"subscriptiondays",text:M.util.get_string("mode_subscriptiondays","availability_dripcontent"),selected:"subscriptiondays"===t},{value:"daterange",text:M.util.get_string("mode_daterange","availability_dripcontent"),selected:"daterange"===t}]);c.contentDiv.appendChild(u),e.appendChild(c.row);var s=document.createElement("div");s.className="form-group row mb-2 dripcontent-timevalue";var m=document.createElement("label");m.className="col-sm-4 col-form-label",m.textContent=M.util.get_string("value","availability_dripcontent");var p=document.createElement("div");p.className="col-sm-4";var v=document.createElement("input");v.type="number",v.className="form-control dripcontent-value",v.min="0",v.value=r,p.appendChild(v);var y=document.createElement("div");y.className="col-sm-4";var f=this.createSelect("dripcontent-unit",[{value:"days",text:M.util.get_string("unit_days","availability_dripcontent"),selected:"days"===n},{value:"weeks",text:M.util.get_string("unit_weeks","availability_dripcontent"),selected:"weeks"===n},{value:"months",text:M.util.get_string("unit_months","availability_dripcontent"),selected:"months"===n}]);y.appendChild(f),s.appendChild(m),s.appendChild(p),s.appendChild(y),e.appendChild(s);var h=this.createFormRow(M.util.get_string("enrolmentmethods","availability_dripcontent"),"dripcontent-enrolmethods");h.row.style.display="none";var g=this.createMultiSelect("dripcontent-enrolmentmethods",o);h.contentDiv.appendChild(g);var b=document.createElement("small");b.className="form-text text-muted",b.textContent=M.util.get_string("enrolmentmethods_help","availability_dripcontent"),h.contentDiv.appendChild(b),e.appendChild(h.row);var _=this.createFormRow(M.util.get_string("fromdate","availability_dripcontent"),"dripcontent-daterange");_.row.style.display="none";var S=document.createElement("input");S.type="date",S.className="form-control dripcontent-fromdate",S.value=l,_.contentDiv.appendChild(S),e.appendChild(_.row);var E=this.createFormRow(M.util.get_string("todate","availability_dripcontent"),"dripcontent-daterange");E.row.style.display="none";var C=document.createElement("input");C.type="date",C.className="form-control dripcontent-todate",C.value=d,E.contentDiv.appendChild(C),e.appendChild(E.row)},timestampToDateString:function(e){return new Date(1e3*e).toISOString().split("T")[0]},dateStringToTimestamp:function(e){if(!e)return null;var t=new Date(e+"T00:00:00");return Math.floor(t.getTime()/1e3)},setupEventListeners:function(e){var t=this,n=e.querySelector(".dripcontent-mode"),r=e.querySelector(".dripcontent-value"),a=e.querySelector(".dripcontent-unit"),i=e.querySelector(".dripcontent-fromdate"),o=e.querySelector(".dripcontent-todate"),l=e.querySelector(".dripcontent-enrolmentmethods");n.addEventListener("change",(function(){t.updateVisibility(e,n.value),M.core_availability.form.update()})),r.addEventListener("input",(function(){M.core_availability.form.update()})),a.addEventListener("change",(function(){M.core_availability.form.update()})),i.addEventListener("change",(function(){M.core_availability.form.update()})),o.addEventListener("change",(function(){M.core_availability.form.update()})),l.addEventListener("change",(function(){M.core_availability.form.update()}))},updateVisibility:function(e,t){var n=e.querySelector(".dripcontent-timevalue"),r=e.querySelectorAll(".dripcontent-daterange"),a=e.querySelector(".dripcontent-enrolmethods");"daterange"===t?(n.style.display="none",a.style.display="none",r.forEach((function(e){e.style.display="flex"}))):"subscriptiondays"===t?(n.style.display="flex",a.style.display="flex",r.forEach((function(e){e.style.display="none"}))):(n.style.display="flex",a.style.display="none",r.forEach((function(e){e.style.display="none"})))},fillValue:function(e,t){var n=t.querySelector(".dripcontent-mode"),r=t.querySelector(".dripcontent-value"),a=t.querySelector(".dripcontent-unit"),i=t.querySelector(".dripcontent-fromdate"),o=t.querySelector(".dripcontent-todate"),l=t.querySelector(".dripcontent-enrolmentmethods");e.mode&&(n.value=e.mode),e.unit&&(a.value=e.unit),void 0!==e.value&&(r.value=e.value),e.fromdate&&(i.value=this.timestampToDateString(e.fromdate)),e.todate&&(o.value=this.timestampToDateString(e.todate)),e.enrolmentmethods&&e.enrolmentmethods.length>0&&Array.from(l.options).forEach((function(t){t.selected=e.enrolmentmethods.includes(t.value)})),this.updateVisibility(t,n.value)},fillErrors:function(e,t){var n=t.querySelector(".dripcontent-mode").value,r=t.querySelector(".dripcontent-value").value,a=t.querySelector(".dripcontent-fromdate").value,i=t.querySelector(".dripcontent-todate").value;"daterange"!==n?(""===r||isNaN(parseInt(r))||parseInt(r)<0)&&e.push("availability_dripcontent:error_invalidvalue"):(a||i||e.push("availability_dripcontent:error_invaliddate"),a&&i&&new Date(a)>=new Date(i)&&e.push("availability_dripcontent:error_dateorder"))},getValue:function(e){var t=e.querySelector(".dripcontent-mode").value,n={type:"dripcontent",mode:t};if("daterange"===t){var r=e.querySelector(".dripcontent-fromdate").value,a=e.querySelector(".dripcontent-todate").value;r&&(n.fromdate=this.dateStringToTimestamp(r)),a&&(n.todate=this.dateStringToTimestamp(a))}else if(n.unit=e.querySelector(".dripcontent-unit").value,n.value=parseInt(e.querySelector(".dripcontent-value").value)||0,"subscriptiondays"===t){var i=e.querySelector(".dripcontent-enrolmentmethods"),o=Array.from(i.selectedOptions).map((function(e){return e.value})).filter((function(e){return""!==e}));o.length>0&&(n.enrolmentmethods=o)}return n}};e.default=r}));