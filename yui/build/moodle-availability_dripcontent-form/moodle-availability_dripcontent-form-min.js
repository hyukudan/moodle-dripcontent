M.availability_dripcontent=M.availability_dripcontent||{},M.availability_dripcontent.form=Y.Object(M.core_availability.plugin),M.availability_dripcontent.form.enrolmentMethods={},M.availability_dripcontent.form.initInner=function(e){this.modes=e.modes,this.units=e.units,this.enrolmentMethods=e.enrolmentmethods||{}},M.availability_dripcontent.form.getNode=function(e){var t=e.mode||"coursedays",a=e.unit||"days",i=void 0!==e.value?e.value:1,n=e.fromdate||"",l=e.todate||"",o=e.enrolmentmethods||[],s='<div class="availability-dripcontent">';s+='<div class="form-group row mb-2">',s+='<label class="col-sm-4 col-form-label">'+M.util.get_string("mode","availability_dripcontent")+"</label>",s+='<div class="col-sm-8"><select name="mode" class="form-control">',s+='<option value="coursedays"'+("coursedays"===t?" selected":"")+">"+M.util.get_string("mode_coursedays","availability_dripcontent")+"</option>",s+='<option value="coursestartdays"'+("coursestartdays"===t?" selected":"")+">"+M.util.get_string("mode_coursestartdays","availability_dripcontent")+"</option>",s+='<option value="subscriptiondays"'+("subscriptiondays"===t?" selected":"")+">"+M.util.get_string("mode_subscriptiondays","availability_dripcontent")+"</option>",s+='<option value="daterange"'+("daterange"===t?" selected":"")+">"+M.util.get_string("mode_daterange","availability_dripcontent")+"</option>",s+="</select></div></div>",s+='<div class="form-group row mb-2 dripcontent-timevalue" style="display:'+("daterange"===t?"none":"flex")+'">',s+='<label class="col-sm-4 col-form-label">'+M.util.get_string("value","availability_dripcontent")+"</label>",s+='<div class="col-sm-4"><input type="number" name="value" class="form-control" min="0" value="'+i+'"></div>',s+='<div class="col-sm-4"><select name="unit" class="form-control">',s+='<option value="days"'+("days"===a?" selected":"")+">"+M.util.get_string("unit_days","availability_dripcontent")+"</option>",s+='<option value="weeks"'+("weeks"===a?" selected":"")+">"+M.util.get_string("unit_weeks","availability_dripcontent")+"</option>",s+='<option value="months"'+("months"===a?" selected":"")+">"+M.util.get_string("unit_months","availability_dripcontent")+"</option>",s+="</select></div></div>";var r="subscriptiondays"===t?"flex":"none";for(var d in s+='<div class="form-group row mb-2 dripcontent-enrolmethods" style="display:'+r+'">',s+='<label class="col-sm-4 col-form-label">'+M.util.get_string("enrolmentmethods","availability_dripcontent")+"</label>",s+='<div class="col-sm-8"><select name="enrolmentmethods" class="form-control" multiple size="4">',s+='<option value=""'+(0===o.length?" selected":"")+">"+M.util.get_string("allenrolmentmethods","availability_dripcontent")+"</option>",this.enrolmentMethods){if(this.enrolmentMethods.hasOwnProperty(d))s+='<option value="'+d+'"'+(-1!==o.indexOf(d)?" selected":"")+">"+this.enrolmentMethods[d]+"</option>"}s+="</select></div></div>";var c="daterange"===t?"flex":"none",m=n?this.timestampToDateString(n):"",p=l?this.timestampToDateString(l):"";s+='<div class="form-group row mb-2 dripcontent-daterange" style="display:'+c+'">',s+='<label class="col-sm-4 col-form-label">'+M.util.get_string("fromdate","availability_dripcontent")+"</label>",s+='<div class="col-sm-8"><input type="date" name="fromdate" class="form-control" value="'+m+'"></div></div>',s+='<div class="form-group row mb-2 dripcontent-daterange" style="display:'+c+'">',s+='<label class="col-sm-4 col-form-label">'+M.util.get_string("todate","availability_dripcontent")+"</label>",s+='<div class="col-sm-8"><input type="date" name="todate" class="form-control" value="'+p+'"></div></div>',s+="</div>";var u=Y.Node.create('<span class="availability_dripcontent">'+s+"</span>");if(!M.availability_dripcontent.form.addedEvents){M.availability_dripcontent.form.addedEvents=!0;var v=Y.one(".availability-field");v.delegate("change",function(){M.availability_dripcontent.form.updateVisibility(this.ancestor(".availability_dripcontent")),M.core_availability.form.update()},".availability_dripcontent select[name=mode]"),v.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent select[name=unit]"),v.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent input[name=value]"),v.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent input[name=fromdate]"),v.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent input[name=todate]"),v.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent select[name=enrolmentmethods]")}return u},M.availability_dripcontent.form.timestampToDateString=function(e){var t=new Date(1e3*e);return t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)},M.availability_dripcontent.form.dateStringToTimestamp=function(e){if(!e)return null;var t=new Date(e+"T00:00:00");return Math.floor(t.getTime()/1e3)},M.availability_dripcontent.form.updateVisibility=function(e){var t=e.one("select[name=mode]").get("value"),a=e.one(".dripcontent-timevalue"),i=e.all(".dripcontent-daterange"),n=e.one(".dripcontent-enrolmethods");"daterange"===t?(a.setStyle("display","none"),n.setStyle("display","none"),i.each(function(e){e.setStyle("display","flex")})):"subscriptiondays"===t?(a.setStyle("display","flex"),n.setStyle("display","flex"),i.each(function(e){e.setStyle("display","none")})):(a.setStyle("display","flex"),n.setStyle("display","none"),i.each(function(e){e.setStyle("display","none")}))},M.availability_dripcontent.form.fillValue=function(e,t){var a=t.one("select[name=mode]").get("value");if(e.mode=a,"daterange"===a){var i=t.one("input[name=fromdate]").get("value"),n=t.one("input[name=todate]").get("value");i&&(e.fromdate=this.dateStringToTimestamp(i)),n&&(e.todate=this.dateStringToTimestamp(n))}else if(e.unit=t.one("select[name=unit]").get("value"),e.value=parseInt(t.one("input[name=value]").get("value"),10)||0,"subscriptiondays"===a){var l=t.one("select[name=enrolmentmethods]"),o=[];l.all("option:checked").each(function(e){var t=e.get("value");""!==t&&o.push(t)}),o.length>0&&(e.enrolmentmethods=o)}},M.availability_dripcontent.form.fillErrors=function(e,t){var a=t.one("select[name=mode]").get("value"),i=t.one("input[name=value]").get("value"),n=t.one("input[name=fromdate]").get("value"),l=t.one("input[name=todate]").get("value");"daterange"!==a?(""===i||isNaN(parseInt(i,10))||parseInt(i,10)<0)&&e.push("availability_dripcontent:error_invalidvalue"):(n||l||e.push("availability_dripcontent:error_invaliddate"),n&&l&&new Date(n)>=new Date(l)&&e.push("availability_dripcontent:error_dateorder"))};