YUI.add("moodle-availability_dripcontent-form",function(d,e){M.availability_dripcontent=M.availability_dripcontent||{},M.availability_dripcontent.form=d.Object(M.core_availability.plugin),M.availability_dripcontent.form.enrolmentMethods={},M.availability_dripcontent.form.initInner=function(e){this.enrolmentMethods=e||{}},M.availability_dripcontent.form.getNode=function(e){var t,a=e.mode||"coursedays",i=e.unit||"days",n=e.value!==undefined?e.value:1,l=e.fromdate||"",o=e.todate||"",s=e.enrolmentmethods||[],r='<div class="availability-dripcontent">',r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r+='<div class="form-group row mb-2">')+('<label class="col-sm-4 col-form-label">'+M.util.get_string("mode","availability_dripcontent")+"</label>")+'<div class="col-sm-8"><select name="mode" class="form-control">')+('<option value="coursedays"'+("coursedays"===a?" selected":"")+">"+M.util.get_string("mode_coursedays","availability_dripcontent")+"</option>"))+('<option value="coursestartdays"'+("coursestartdays"===a?" selected":"")+">"+M.util.get_string("mode_coursestartdays","availability_dripcontent")+"</option>"))+('<option value="subscriptiondays"'+("subscriptiondays"===a?" selected":"")+">"+M.util.get_string("mode_subscriptiondays","availability_dripcontent")+"</option>"))+('<option value="daterange"'+("daterange"===a?" selected":"")+">"+M.util.get_string("mode_daterange","availability_dripcontent")+"</option>"))+"</select></div></div>"+('<div class="form-group row mb-2 dripcontent-timevalue" style="display:'+("daterange"===a?"none":"flex")+'">'))+('<label class="col-sm-4 col-form-label">'+M.util.get_string("value","availability_dripcontent")+"</label>"))+('<div class="col-sm-4"><input type="number" name="value" class="form-control" min="0" value="'+n+'"></div>')+'<div class="col-sm-4"><select name="unit" class="form-control">')+('<option value="days"'+("days"===i?" selected":"")+">"+M.util.get_string("unit_days","availability_dripcontent")+"</option>"))+('<option value="weeks"'+("weeks"===i?" selected":"")+">"+M.util.get_string("unit_weeks","availability_dripcontent")+"</option>"))+('<option value="months"'+("months"===i?" selected":"")+">"+M.util.get_string("unit_months","availability_dripcontent")+"</option>"))+"</select></div></div>"+('<div class="form-group row mb-2 dripcontent-enrolmethods" style="display:'+("subscriptiondays"===a?"flex":"none")+'">'))+('<label class="col-sm-4 col-form-label">'+M.util.get_string("enrolmentmethods","availability_dripcontent")+"</label>")+'<div class="col-sm-8"><select name="enrolmentmethods" class="form-control" multiple size="4">')+('<option value=""'+(0===s.length?" selected":"")+">"+M.util.get_string("allenrolmentmethods","availability_dripcontent")+"</option>");for(t in this.enrolmentMethods)this.enrolmentMethods.hasOwnProperty(t)&&(r+='<option value="'+t+'"'+(-1!==s.indexOf(t)?" selected":"")+">"+this.enrolmentMethods[t]+"</option>");return r+="</select></div></div>",e="daterange"===a?"flex":"none",n=l?this.timestampToDateString(l):"",i=o?this.timestampToDateString(o):"",r=(r=(r=(r+='<div class="form-group row mb-2 dripcontent-daterange" style="display:'+e+'">')+('<label class="col-sm-4 col-form-label">'+M.util.get_string("fromdate","availability_dripcontent")+"</label>"))+('<div class="col-sm-8"><input type="date" name="fromdate" class="form-control" value="'+n+'"></div></div>')+('<div class="form-group row mb-2 dripcontent-daterange" style="display:'+e+'">'))+('<label class="col-sm-4 col-form-label">'+M.util.get_string("todate","availability_dripcontent")+"</label>"),a=d.Node.create('<span class="availability_dripcontent">'+(r=r+('<div class="col-sm-8"><input type="date" name="todate" class="form-control" value="'+i+'"></div></div>')+"</div>")+"</span>"),M.availability_dripcontent.form.addedEvents||(M.availability_dripcontent.form.addedEvents=!0,(l=d.one(".availability-field")).delegate("change",function(){M.availability_dripcontent.form.updateVisibility(this.ancestor(".availability_dripcontent")),M.core_availability.form.update()},".availability_dripcontent select[name=mode]"),l.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent select[name=unit]"),l.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent input[name=value]"),l.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent input[name=fromdate]"),l.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent input[name=todate]"),l.delegate("change",function(){M.core_availability.form.update()},".availability_dripcontent select[name=enrolmentmethods]")),a},M.availability_dripcontent.form.timestampToDateString=function(e){var e=new Date(1e3*e),t=e.getFullYear(),a=("0"+(e.getMonth()+1)).slice(-2),e=("0"+e.getDate()).slice(-2);return t+"-"+a+"-"+e},M.availability_dripcontent.form.dateStringToTimestamp=function(e){if(!e)return null;e=new Date(e+"T00:00:00");return Math.floor(e.getTime()/1e3)},M.availability_dripcontent.form.updateVisibility=function(e){var t=e.one("select[name=mode]").get("value"),a=e.one(".dripcontent-timevalue"),i=e.all(".dripcontent-daterange"),e=e.one(".dripcontent-enrolmethods");"daterange"===t?(a.setStyle("display","none"),e.setStyle("display","none"),i.each(function(e){e.setStyle("display","flex")})):"subscriptiondays"===t?(a.setStyle("display","flex"),e.setStyle("display","flex"),i.each(function(e){e.setStyle("display","none")})):(a.setStyle("display","flex"),e.setStyle("display","none"),i.each(function(e){e.setStyle("display","none")}))},M.availability_dripcontent.form.fillValue=function(e,t){var a,i,n,l=t.one("select[name=mode]").get("value");"daterange"===(e.mode=l)?(i=t.one("input[name=fromdate]").get("value"),a=t.one("input[name=todate]").get("value"),i&&(e.fromdate=this.dateStringToTimestamp(i)),a&&(e.todate=this.dateStringToTimestamp(a))):(e.unit=t.one("select[name=unit]").get("value"),e.value=parseInt(t.one("input[name=value]"
).get("value"),10)||0,"subscriptiondays"===l&&(i=t.one("select[name=enrolmentmethods]"),n=[],i.all("option:checked").each(function(e){e=e.get("value");""!==e&&n.push(e)}),0<n.length&&(e.enrolmentmethods=n)))},M.availability_dripcontent.form.fillErrors=function(e,t){var a=t.one("select[name=mode]").get("value"),i=t.one("input[name=value]").get("value"),n=t.one("input[name=fromdate]").get("value"),t=t.one("input[name=todate]").get("value");"daterange"!==a?(""===i||isNaN(parseInt(i,10))||parseInt(i,10)<0)&&e.push("availability_dripcontent:error_invalidvalue"):(n||t||e.push("availability_dripcontent:error_invaliddate"),n&&t&&(a=new Date(n),new Date(t)<=a&&e.push("availability_dripcontent:error_dateorder")))}},"@VERSION@",{requires:["base","node","event","moodle-core_availability-form"]});